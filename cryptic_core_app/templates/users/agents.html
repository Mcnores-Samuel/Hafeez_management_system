{% extends "base.html" %}
{% block sidebar %}
<div class="sidebar-containter">
    <nav class="sidebar">
        <a href="#agent-stock">My Stock</a>
        <a href="#">My Customers</a>
        <a href="#">Agents</a>
        <a href="#">Customer Data</a>
    </nav>
</div>
{% endblock %}
{% block content %}
<section class="agents_stock" id="agent-stock">
            <table class="stock-table">
                <caption>Stock In</caption>
                <thead>
                    <tr>
                        <th>imei</th>
                        <th>phone</th>
                        <th>sale</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in stock_in %}
                        <tr>
                            <td>{{ item.imei_number }}</td>
                            <td>{{ item.phone_type }}</td>
                            <td>
                                <a href="{% url 'combinedData_collection' data_id=item.id %}"><i class='bx bx-chevrons-right'></i></a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            <table class="stock-table">
                <caption>Stock Out</caption>
                <thead>
                    <tr>
                        <th>imei</th>
                        <th>phone</th>
                        <th>assigned on</th>
                        <th>sold on</th>
                        <th>contract No</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in stock_out %}
                    <tr>
                        <td>{{ item.imei_number }}</td>
                        <td>{{ item.phone_type }}</td>
                        <td>{{ item.collection_date }}</td>
                        <td>{{ item.stock_out_date }}</td>
                        {% if item.contract_number and item.sales_type == 'Loan' %}
                            <td>{{ item.contract_number}}</td>
                        {% elif not item.contract_number and item.sales_type == 'Cash' %}
                            <td>{{ item.contract_number}}</td>
                        {% else %}
                            <td>
                                <form action="" method="post" class="contract_number_form">
                                    {% csrf_token %}
                                    <input type="text" name="contract_number" placeholder="Add contract number" maxlength="8" minlength="8" pattern="[A]{1}[0-9]{7}">
                                    <input type="hidden" name="imei_number" value="{{ item.imei_number }}">
                                    <button type="submit" class="contract_number-btn" onclick="save_contract_number()">save</button>
                                </form>
                            </td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
</section>
<section class="mobile-display">
    <div class="in_stock">
        <h2>Stock In</h2>
        <div>
            <p>Total devices: <span>{{ total_stock_in }}</span></p>
        </div>
        <a href="{% url 'in_stock' %}"><button>make sales</button></a>
    </div>
    <div class="stock_out">
        <h2>Stock out</h2>
        <div>
            <p>Total sales: <span>{{ total_stock_out }}</span></p>
            <p>Pending actions: <span>{{ pending }}</span></p>
        </div>
        <a href="{% url 'stock_out' %}"><button>complete Pending actions</button></a>
    </div>
</section>
{% endblock %}